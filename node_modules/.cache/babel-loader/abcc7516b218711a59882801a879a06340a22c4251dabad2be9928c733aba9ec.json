{"ast":null,"code":"'use strict';\n\nconst util = require('../core/util');\nconst {\n  InvalidArgumentError,\n  RequestAbortedError\n} = require('../core/errors');\nconst DecoratorHandler = require('../handler/decorator-handler');\nclass DumpHandler extends DecoratorHandler {\n  #maxSize = 1024 * 1024;\n  #abort = null;\n  #dumped = false;\n  #aborted = false;\n  #size = 0;\n  #reason = null;\n  #handler = null;\n  constructor({\n    maxSize\n  }, handler) {\n    super(handler);\n    if (maxSize != null && (!Number.isFinite(maxSize) || maxSize < 1)) {\n      throw new InvalidArgumentError('maxSize must be a number greater than 0');\n    }\n    this.#maxSize = maxSize ?? this.#maxSize;\n    this.#handler = handler;\n  }\n  onConnect(abort) {\n    this.#abort = abort;\n    this.#handler.onConnect(this.#customAbort.bind(this));\n  }\n  #customAbort(reason) {\n    this.#aborted = true;\n    this.#reason = reason;\n  }\n\n  // TODO: will require adjustment after new hooks are out\n  onHeaders(statusCode, rawHeaders, resume, statusMessage) {\n    const headers = util.parseHeaders(rawHeaders);\n    const contentLength = headers['content-length'];\n    if (contentLength != null && contentLength > this.#maxSize) {\n      throw new RequestAbortedError(`Response size (${contentLength}) larger than maxSize (${this.#maxSize})`);\n    }\n    if (this.#aborted) {\n      return true;\n    }\n    return this.#handler.onHeaders(statusCode, rawHeaders, resume, statusMessage);\n  }\n  onError(err) {\n    if (this.#dumped) {\n      return;\n    }\n    err = this.#reason ?? err;\n    this.#handler.onError(err);\n  }\n  onData(chunk) {\n    this.#size = this.#size + chunk.length;\n    if (this.#size >= this.#maxSize) {\n      this.#dumped = true;\n      if (this.#aborted) {\n        this.#handler.onError(this.#reason);\n      } else {\n        this.#handler.onComplete([]);\n      }\n    }\n    return true;\n  }\n  onComplete(trailers) {\n    if (this.#dumped) {\n      return;\n    }\n    if (this.#aborted) {\n      this.#handler.onError(this.reason);\n      return;\n    }\n    this.#handler.onComplete(trailers);\n  }\n}\nfunction createDumpInterceptor({\n  maxSize: defaultMaxSize\n} = {\n  maxSize: 1024 * 1024\n}) {\n  return dispatch => {\n    return function Intercept(opts, handler) {\n      const {\n        dumpMaxSize = defaultMaxSize\n      } = opts;\n      const dumpHandler = new DumpHandler({\n        maxSize: dumpMaxSize\n      }, handler);\n      return dispatch(opts, dumpHandler);\n    };\n  };\n}\nmodule.exports = createDumpInterceptor;","map":{"version":3,"names":["util","require","InvalidArgumentError","RequestAbortedError","DecoratorHandler","DumpHandler","maxSize","abort","dumped","aborted","size","reason","handler","constructor","Number","isFinite","onConnect","customAbort","bind","#customAbort","onHeaders","statusCode","rawHeaders","resume","statusMessage","headers","parseHeaders","contentLength","onError","err","onData","chunk","length","onComplete","trailers","createDumpInterceptor","defaultMaxSize","dispatch","Intercept","opts","dumpMaxSize","dumpHandler","module","exports"],"sources":["/Users/nataliia/PussyProjects/react-app/node_modules/undici/lib/interceptor/dump.js"],"sourcesContent":["'use strict'\n\nconst util = require('../core/util')\nconst { InvalidArgumentError, RequestAbortedError } = require('../core/errors')\nconst DecoratorHandler = require('../handler/decorator-handler')\n\nclass DumpHandler extends DecoratorHandler {\n  #maxSize = 1024 * 1024\n  #abort = null\n  #dumped = false\n  #aborted = false\n  #size = 0\n  #reason = null\n  #handler = null\n\n  constructor ({ maxSize }, handler) {\n    super(handler)\n\n    if (maxSize != null && (!Number.isFinite(maxSize) || maxSize < 1)) {\n      throw new InvalidArgumentError('maxSize must be a number greater than 0')\n    }\n\n    this.#maxSize = maxSize ?? this.#maxSize\n    this.#handler = handler\n  }\n\n  onConnect (abort) {\n    this.#abort = abort\n\n    this.#handler.onConnect(this.#customAbort.bind(this))\n  }\n\n  #customAbort (reason) {\n    this.#aborted = true\n    this.#reason = reason\n  }\n\n  // TODO: will require adjustment after new hooks are out\n  onHeaders (statusCode, rawHeaders, resume, statusMessage) {\n    const headers = util.parseHeaders(rawHeaders)\n    const contentLength = headers['content-length']\n\n    if (contentLength != null && contentLength > this.#maxSize) {\n      throw new RequestAbortedError(\n        `Response size (${contentLength}) larger than maxSize (${\n          this.#maxSize\n        })`\n      )\n    }\n\n    if (this.#aborted) {\n      return true\n    }\n\n    return this.#handler.onHeaders(\n      statusCode,\n      rawHeaders,\n      resume,\n      statusMessage\n    )\n  }\n\n  onError (err) {\n    if (this.#dumped) {\n      return\n    }\n\n    err = this.#reason ?? err\n\n    this.#handler.onError(err)\n  }\n\n  onData (chunk) {\n    this.#size = this.#size + chunk.length\n\n    if (this.#size >= this.#maxSize) {\n      this.#dumped = true\n\n      if (this.#aborted) {\n        this.#handler.onError(this.#reason)\n      } else {\n        this.#handler.onComplete([])\n      }\n    }\n\n    return true\n  }\n\n  onComplete (trailers) {\n    if (this.#dumped) {\n      return\n    }\n\n    if (this.#aborted) {\n      this.#handler.onError(this.reason)\n      return\n    }\n\n    this.#handler.onComplete(trailers)\n  }\n}\n\nfunction createDumpInterceptor (\n  { maxSize: defaultMaxSize } = {\n    maxSize: 1024 * 1024\n  }\n) {\n  return dispatch => {\n    return function Intercept (opts, handler) {\n      const { dumpMaxSize = defaultMaxSize } =\n        opts\n\n      const dumpHandler = new DumpHandler(\n        { maxSize: dumpMaxSize },\n        handler\n      )\n\n      return dispatch(opts, dumpHandler)\n    }\n  }\n}\n\nmodule.exports = createDumpInterceptor\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}